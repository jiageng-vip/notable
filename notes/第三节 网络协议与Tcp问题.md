---
tags: [Swoole]
title: 第三节 网络协议与Tcp问题
created: '2022-05-03T09:29:33.277Z'
modified: '2022-05-03T09:33:16.854Z'
---

# 第三节 网络协议与Tcp问题

##### TCP&UDP介绍与区别
```
***TCP(Transmission Control Protocol传输控制协议): *** 是一 种面向连接的、可靠的、基于字节流的传输层通信协议，使用三次握手协议建立连接、四次挥手断开连接。面向连接意味着两个使用TCP的应用(通常是一个 客户端和一 个服务器)在彼此交换数据包之前必须先建立一一个TCP连接。在一一个TCP连接中，仅有两方进行彼此通信，广播和多播不能用TCP。TCP协议的作用是，保证数据通信的完整性和可靠性，防止丢包。TCP把 连接作为最基本的对象,每-条TCP连接都有两个端点, 这种端点我们叫作套接字(socket),端口号拼接到IP地址即构成了套接字。
***UDP(User Datagram Protocol用户数据报协议): *** 是OSI(Open System Interconnection开放式系统互联)参考模型中- -种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务。UDP协议的主要作用是将网 络数据流量压缩成数据包的形式。
​
1. TCP提供的是面向连接的、可靠的数据流传输; UDP提供的是非面向连接的、不可靠的数据流传输。
2. TCP提供可靠的服务，通过TCP连接传送的数据，无差错、不丢失、不重复，按序到达; UDP尽最大努力交付，即不保证可靠交付。 
3. TCP面向字节流; UDP面向报文。
4. TCP连接只能是点到点的; UDP支持-对一、一对多 多对一和多对多的交互通信。
5. UDP具有较好的实时性，工作效率比TCP高，适用于对高速传输和实时性有较高的通信或广播通信。
6. TCP对系统资源要求较多，UDP对系统资源要求较少。TCP首部有20字节; UDP的首部只有8个字节。
7. TCP的逻辑通信信道是全双工的可靠信道; UDP的逻辑通信信道是不可靠信道。
```
##### TCP解释
```
. TCP协议简介 TCP是TCP/IP体系中非常复杂的一个协议，TCP最主要的特点有:
1. TCP是面向连接的运输层协议。应用程序在使用TCP协议之前，必须先建立TCP连接。在传递数据完毕后，必须释放已建立的TCP连接。
2. 每一条TCP连接只能有两个端点，只能说点对点的。
3. TCP提供可靠交付的服务，通过TCP连接传送的数据，无差错，不丢失，不重复，并且按序到达。
4. TCP提供全双工通信。TCP允许通信双方的应用进程在任何时候都能发送数据。TCP连接的两端都设有发送缓存和接收缓存，用来临时存放双向通信的数据。
5. 面向字节流。TCP中的“流”指的是流入到进程或从进程流出的字节序列。“面向字节流”的含义是:虽然应用程序和TCP的交互是一-次一个数据块(大小不等)，但TCP把应用程序交下来的数据看成仅仅是一连 串的无结构的字节流。TCP并不知道所传送的字节流的含义。TCP不保证接收方应用程序所收到的数据块和发送方应用程序所发出的数据块具有对应大小的关系。但接收方应用程序收到的字节流必须和发送方应用程序发出的字 节流完全一一样。 当然，接收方的应用程序必须有能力识别收到的字节流，把它还原成有意义的应用层数据。
​
可靠传输
流量控制
拥塞控制
```
##### TCP问题
```
tcp在发送数据的时候因为存在数据缓存的关系，对于数据在发送的时候在短时间内如果连续发送很多小的数据的时候就会有可能一次性一起发送，还有就是对于大的数据就会分开连续发送多次
```
##### 沾包
```
一个数据在发送的时候跟上了另一个数据的信息，另一个数据的信息可能是完整的也可能是不完整的
​
出现的原因:
出现粘包现象的原因是多方面的，它既可能由发送方造成，也可能由接收方造成。发送方引起的粘包是由TCP协议本身造成的, TCP为提高传输效率,发送方往往要收集到足够多的数据后才发送一包数据。 若连续几次发送 的数据都很少，通常TCP会根据优化算法把这些数据合成- -包后- 次发送出去，这样接收方就收到了粘包数据。
接收方引起的粘包是由于接收方用户进程不及时接收数据，从而导致粘包现象。这是因为接收方先把收到的数据放在系统接收缓冲区，用户进程从该缓冲区取数据，若下一-包数据到达时前一-包数据尚未被用户进程取 走,则下一包数据放到系统接收缓冲区时就接到前一包数据之后，而用户进程根据预先设定的缓冲区大小从系统接收缓冲区取数据，这样就一-次取到了 多包数据。
```
##### Swoole 沾包解决方案
```
解决方案-1-粘包-特殊字符方式 $client->send("hello world\i"); var_dump(explode('\i', $data));
通过EOF的方式处理  $swoole->set([ 'open_eof_split' => true, 'package_eof' => "\r\n",]);
解决方案-统-1-粘包-一标准(固定包头+包体协议) 
```
